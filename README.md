# üè† Homelab Bootstrap Infrastructure

> **Bootstrap —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞**

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

Bootstrap —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞:
- K3s –∫–ª–∞—Å—Ç–µ—Ä
- ArgoCD –¥–ª—è GitOps
- –ë–∞–∑–æ–≤–∞—è —Å–µ—Ç–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## –ß—Ç–æ –ù–ï –≤–∫–ª—é—á–µ–Ω–æ
- Pi-hole (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è ArgoCD)
- Traefik (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è ArgoCD)
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è ArgoCD)

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Ubuntu Server 22.04/24.04 LTS
- 2+ CPU, 4+ GB RAM, 20+ GB disk

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
```bash
curl -fsSL https://mozg.dev/homelab.sh | bash
```

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ bootstrap –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, ArgoCD –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–µ—Ä–Ω–µ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏–∑ homelab-k8s —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

## üèóÔ∏è –ß—Ç–æ –ø–æ–ª—É—á–∏—Ç–µ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### Bootstrap –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **K3s** - –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π Kubernetes –∫–ª–∞—Å—Ç–µ—Ä
- **ArgoCD** - GitOps –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è CD
- **–ë–∞–∑–æ–≤–∞—è —Å–µ—Ç–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**

### –£–ø—Ä–∞–≤–ª—è–µ–º—ã–µ ArgoCD —Å–µ—Ä–≤–∏—Å—ã
| –°–µ—Ä–≤–∏—Å | –¢–∏–ø –¥–æ—Å—Ç—É–ø–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|-------------|------------|
| Pi-hole | hostNetwork | DNS/DHCP —Å–µ—Ä–≤–µ—Ä |
| Traefik | hostNetwork | Ingress –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä |
| –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è | ClusterIP | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã |

## üåê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ—Å—Ç—É–ø–∞

### Bootstrap —Ñ–∞–∑–∞:
```
External Client
      ‚Üì
Master Node WAN IP (192.168.1.150)
      ‚Üì kubectl port-forward
ArgoCD Pod (ClusterIP)
```

### –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è ArgoCD:
```
External Client
      ‚Üì HTTP/HTTPS
Master Node WAN IP (192.168.1.150:80/443)
      ‚Üì hostNetwork
Traefik Pod
      ‚Üì Kubernetes DNS
pihole.pihole.svc.cluster.local
      ‚Üì
Pi-hole Pod (ClusterIP)
```

### –°–µ—Ç–µ–≤–∞—è —Ç–æ–ø–æ–ª–æ–≥–∏—è:
```
                    MASTER NODE
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
–õ–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å ‚Üê‚îÄ‚îÄ‚îÄ‚î§ LAN   ‚îÇ WAN ‚îú‚îÄ‚îÄ‚îÄ‚Üí –í–Ω–µ—à–Ω–∏–π –º–∏—Ä
10.0.0.0/24        ‚îÇ10.0.0.1‚îÇ192.168.1.150‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                           ‚îÇ
         ‚îÇ                           ‚îÇ
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ –ö–û–ú–ú–£–¢–ê–¢–û–†  ‚îÇ            ‚îÇ    ROUTER   ‚îÇ
   ‚îÇ             ‚îÇ            ‚îÇ 192.168.1.1 ‚îÇ
   ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ                              ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îÇ
‚îÇ SlaveNode + PC's ‚îÇ            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  ‚îÇ            ‚îÇInternet ‚îÇ
‚îÇ  10.0.0.51-.250  ‚îÇ            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
- **hostNetwork** –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (Traefik, Pi-hole DHCP/DNS)
- **ClusterIP** –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (ArgoCD, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- **Kubernetes DNS** –¥–ª—è service discovery
- **–ù–µ—Ç LoadBalancer** - —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è bootstrap –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Kubernetes –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π service discovery —á–µ—Ä–µ–∑ DNS
- GitOps —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
–°–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –ø–æ–ø—Ä–æ—Å–∏—Ç –≤—ã–±—Ä–∞—Ç—å —Ç–∏–ø —É–∑–ª–∞ –∏ —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑ –ø—Ä–æ–º–ø—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp installer/.env.template ~/homelab/.env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–æ–ª–∏
nano ~/homelab/.env

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É - –ø—Ä–æ–º–ø—Ç–æ–≤ –Ω–µ –±—É–¥–µ—Ç
./installer/install.sh
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö —É–∑–ª–æ–≤
```bash
# –ù–∞ –Ω–æ–≤–æ–π –º–∞—à–∏–Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫
curl -fsSL https://raw.githubusercontent.com/razumnyak/homelab/main/homelab.sh | bash

# –í—ã–±—Ä–∞—Ç—å "slave-node"
# –£–∫–∞–∑–∞—Ç—å IP –º–∞—Å—Ç–µ—Ä–∞ –∏ —Ç–æ–∫–µ–Ω –∫–ª–∞—Å—Ç–µ—Ä–∞
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **–ù–∏–∫–∞–∫–∏—Ö —Ö–∞—Ä–¥–∫–æ–¥ –ø–∞—Ä–æ–ª–µ–π** - –≤—Å–µ —á–µ—Ä–µ–∑ .env —Ñ–∞–π–ª
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è SSH –∫–ª—é—á–µ–π** —Å GitHub
- **ClusterIP –∏–∑–æ–ª—è—Ü–∏—è** - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑–≤–Ω–µ
- **hostNetwork —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**

## üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–º

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
kubectl get nodes
kubectl get pods -A
kubectl get svc -A
```

### –î–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
ArgoCD –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ homelab-k8s —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:
1. Bootstrap —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç ArgoCD —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º App-of-Apps
2. ArgoCD –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ homelab-k8s —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
3. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ homelab-k8s –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
homelab/
‚îú‚îÄ‚îÄ homelab.sh                           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - –≥–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ README.md                            # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ installer/                           # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
    ‚îú‚îÄ‚îÄ install.sh                       # –ì–ª–∞–≤–Ω—ã–π —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫
    ‚îî‚îÄ‚îÄ scripts/                         # –ú–æ–¥—É–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
        ‚îú‚îÄ‚îÄ 00-cloud-init-reset.sh       # –°–±—Ä–æ—Å cloud-init –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        ‚îú‚îÄ‚îÄ 01-cleanup-existing.sh       # –û—á–∏—Å—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫
        ‚îú‚îÄ‚îÄ 02-environment-setup.sh      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
        ‚îú‚îÄ‚îÄ 05-system-prerequisites.sh   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        ‚îú‚îÄ‚îÄ 06-configure-network.sh      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–µ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        ‚îú‚îÄ‚îÄ 07-install-k3s-master.sh     # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ K3s master —É–∑–ª–∞
        ‚îú‚îÄ‚îÄ 08-install-k3s-agent.sh      # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ K3s agent —É–∑–ª–∞
        ‚îú‚îÄ‚îÄ 12-install-argocd.sh         # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ArgoCD GitOps
        ‚îú‚îÄ‚îÄ 14-setup-cron-jobs.sh        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron –∑–∞–¥–∞–Ω–∏–π
        ‚îú‚îÄ‚îÄ 99-post-install-check.sh     # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
        ‚îú‚îÄ‚îÄ common-functions.sh          # –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤
        ‚îú‚îÄ‚îÄ smart-ssh-key-updater.sh     # –£–º–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ SSH –∫–ª—é—á–µ–π
        ‚îú‚îÄ‚îÄ ssh-key-manager.sh           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SSH –∫–ª—é—á–∞–º–∏
        ‚îî‚îÄ‚îÄ update-nodes-list.sh         # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —É–∑–ª–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞
```

## üêõ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –õ–æ–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
```bash
cat ~/homelab/logs/install-*.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
systemctl status k3s          # –Ω–∞ master
systemctl status k3s-agent    # –Ω–∞ slave
```

### –î–æ—Å—Ç—É–ø –∫ ArgoCD
```bash
# –í—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –≤ bootstrap —Ñ–∞–∑–µ
kubectl port-forward -n argocd svc/argocd-server 8080:80
# –ó–∞—Ç–µ–º: http://localhost:8080

# –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Traefik
# https://argocd.local
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
kubectl get svc -A
kubectl get pods -A
```

## ü§ù –£—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è  
2. –í–Ω–µ—Å–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. Pull Request

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ –¥–ª—è –ª–∏—á–Ω—ã—Ö –∏ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- [K3s](https://k3s.io/) - Lightweight Kubernetes
- [ArgoCD](https://argo-cd.readthedocs.io/) - GitOps Continuous delivery
- [Pi-hole](https://pi-hole.net/) - Network-wide Ad Blocking (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è ArgoCD)
- [Traefik](https://traefik.io/) - Modern HTTP Reverse Proxy (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è ArgoCD)

---

**‚≠ê –ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –ø–æ–º–æ–≥ - –ø–æ—Å—Ç–∞–≤—å—Ç–µ –∑–≤–µ–∑–¥–æ—á–∫—É!**